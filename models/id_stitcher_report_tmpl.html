<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ID Stitcher Report</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            margin: 0;
            padding: 0;
            text-align: left;
        }

        h1, h2, h3 {
            color: #4CAF50;
        }

        .content {
            max-width: 800px;
            margin: 0 auto;
            padding: 1em;
        }

        .table-of-contents {
            margin-bottom: 2em;
        }

        .table-container {
            margin-bottom: 3em;
        }

        .table-container table {
            border-collapse: collapse;
            width: 100%;
            margin-top: 1em;
        }

        .table-container th,
        .table-container td {
            border: 1px solid #dddddd;
            text-align: left;
            padding: 0.5em;
        }

        .table-container th {
            background-color: #f2f2f2;
        }

        img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 1em 0;
        }

        .intro {
            margin-bottom: 2em;
            font-style: italic;
        }
    </style>
</head>
<body>
    <img alt="" src="./{{ this.DeRef("static/logo.jpg") }}" style="width: 500px; height: auto" />
    {% set query_models = ["models/clusters", "models/overall_stats", "models/clusters_sorted_by_size", "models/clusters_sorted_by_dist", "models/top_max_degree_nodes", "models/edges_graph", "models/edges_biggest_cluster", "models/id_type_count", "models/id_count"] %}
    <div class="content">
        <h1>ID Stitcher Report</h1>

        <div class="table-of-contents">
            <h2>Table of Contents</h2>
            <ul id="toc">
                <li><a href="#introduction">Introduction</a></li>
                <li><a href="#id-graph">ID Graph</a></li>
                <li><a href="#biggest-cluster">Biggest Cluster</a></li>
                <li><a href="#tables">Tables</a></li>
            </ul>
        </div>

        <div id="introduction" class="intro">
            <p>This report provides an overview of the ID Stitcher functionality, which is crucial for maintaining the integrity of ID graphs and clusters. This document highlights key insights into top clusters and nodes, offering visual and tabular data representation for in-depth analysis.</p>
        </div>

        <h2 id="id-graph">ID Graph</h2>
        <p>The ID Graph section displays the top clusters, sorted by size. Each cluster features the top nodes, sorted by their degree. Only edges connecting these nodes are shown; some nodes might have additional unseen edges.</p>
        <img src="{{this.DbObjectName('id_graph.png')}}" alt="ID Graph">

        <h2 id="biggest-cluster">Biggest Cluster</h2>
        <p>The Biggest Cluster section highlights the top nodes, sorted by their degree. Similar to the ID Graph, only edges connecting these nodes are displayed, though more edges may exist that are not shown.</p>
        <img src="{{this.DbObjectName('biggest_cluster.png')}}" alt="Biggest Cluster">

        <h2 id="tables">Tables</h2>
        <p>This section provides detailed data tables derived from various models, showcasing clusters, statistics, and ID counts.</p>

        {% for qmodel in query_models %}
            <script src={{ this.DeRef(qmodel) }}></script>
        {% endfor %}

        <script>
            function renderTable(data, tableName) {
                const containerDiv = document.createElement("div");
                containerDiv.classList.add("table-container");
                containerDiv.id = tableName.toLowerCase().replace(/ /g, '-');

                const heading = document.createElement("h3");
                heading.textContent = tableName;
                containerDiv.appendChild(heading);

                const table = document.createElement("table");

                const headerRow = document.createElement("tr");
                data.Columns.forEach((column) => {
                    const th = document.createElement("th");
                    th.textContent = column;
                    headerRow.appendChild(th);
                });
                table.appendChild(headerRow);

                data.Results.forEach((rowData) => {
                    const row = document.createElement("tr");
                    rowData.forEach((value) => {
                        const td = document.createElement("td");
                        td.textContent = value;
                        row.appendChild(td);
                    });
                    table.appendChild(row);
                });

                containerDiv.appendChild(table);

                document.querySelector('.content').appendChild(containerDiv);

                // Add to Table of Contents
                const tocList = document.getElementById('toc');
                const tocItem = document.createElement('li');
                const tocLink = document.createElement('a');
                tocLink.href = `#${containerDiv.id}`;
                tocLink.textContent = tableName;
                tocItem.appendChild(tocLink);
                tocList.appendChild(tocItem);
            }

            window.onload = function () {
                {% for qmodel in query_models %}
                    renderTable({{ this.DeRef(qmodel).Name() }}, "{{ this.DeRef(qmodel).GetModel() }}");
                {% endfor %}
            };
        </script>
    </div>
</body>
</html>
